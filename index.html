<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Focus Planner Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;700;900&family=Inter:wght@400;800&display=swap" rel="stylesheet">
    <style>
        * { touch-action: none; -webkit-user-select: none; user-select: none; }
        body { font-family: 'Prompt', sans-serif; background: #f1f5f9; overflow: hidden; position: fixed; width: 100%; height: 100%; }
        .main-card { background: white; border-radius: 2rem; box-shadow: 0 10px 40px rgba(0,0,0,0.08); height: 95vh; margin-top: 10px; }
        .slot { border-radius: 3px; background: #f1f5f9; height: 1.5rem; border: 0.5px solid #e2e8f0; }
        .subject-btn { transition: 0.2s; filter: grayscale(1); opacity: 0.4; border: 2px solid transparent; position: relative; }
        .subject-btn.active { filter: grayscale(0); opacity: 1; border-color: currentColor; background: white !important; transform: scale(1.05); }
        .delete-sub { position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 10px; display: flex; align-items: center; justify-content: center; visibility: hidden; }
        .subject-btn:hover .delete-sub { visibility: visible; }
        .no-scrollbar::-webkit-scrollbar { width: 0px; }
        #mainGrid { touch-action: none; overflow-y: auto; padding-right: 5px; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å */
        #photoTemplate { display: none; position: absolute; left: -9999px; }
        #captureArea { background: white; padding: 30px; width: 550px; border-radius: 2rem; color: #1e293b; }
        .focus-badge { background: #1e293b; color: white; padding: 12px 25px; border-radius: 1.5rem; text-align: center; }
        .focus-number { font-family: 'Inter', sans-serif; font-weight: 800; font-size: 2.2rem; line-height: 1; }
    </style>
</head>
<body class="p-2 flex justify-center items-start">

    <div class="main-card max-w-4xl w-full p-4 md:p-8 flex flex-col">
        <header class="flex justify-between items-center mb-4">
            <div>
                <input type="date" id="planDate" class="text-slate-400 text-sm font-bold border-none outline-none bg-transparent block">
                <h2 class="text-2xl md:text-4xl font-900 text-slate-800 uppercase italic tracking-tighter">FADLEEROMDON</h2>
            </div>
            <button onclick="takeSnap()" class="bg-indigo-600 text-white px-5 py-2.5 rounded-xl font-bold text-sm active:scale-95 transition">üì∏ SAVE IMAGE</button>
        </header>

        <div id="subList" class="flex gap-2 overflow-x-auto pb-3 mb-3 no-scrollbar border-b border-slate-100">
            <button id="eraserBtn" onclick="setEraser(this)" class="subject-btn active min-w-[75px] p-2 rounded-xl text-center bg-slate-100 text-slate-400">
                <div class="text-lg">üßº</div><div class="text-[7px] font-900 uppercase">Eraser</div>
            </button>
            
            <button onclick="openAddSubject()" class="border-2 border-dashed border-slate-200 min-w-[75px] p-2 rounded-xl text-center text-slate-300 active:scale-90">
                <div class="text-lg">+</div><div class="text-[7px] font-900 uppercase">Add Sub</div>
            </button>
        </div>

        <div id="mainGrid" class="space-y-1 flex-1 no-scrollbar"></div>
    </div>

    <div id="photoTemplate"><div id="captureArea">
        <div class="flex justify-between items-end mb-6 border-b border-slate-100 pb-5">
            <div><p id="snapDate" class="text-indigo-500 font-900 text-[10px] uppercase mb-1"></p><h2 class="text-3xl font-900 text-slate-800 italic uppercase">FADLEEROMDON</h2></div>
            <div class="focus-badge"><p class="text-[8px] font-900 uppercase opacity-60">Total Focus</p><div id="snapTotal" class="focus-number">0h 00m</div></div>
        </div>
        <div id="filteredGrid" class="space-y-1"></div>
    </div></div>

    <script>
        let isDragging = false, isEraser = true, curCol = '#6366f1';
        let subjects = JSON.parse(localStorage.getItem('mySubs')) || [
            {name:'Quran', col:'#6366f1', icon:'üìñ'},
            {name:'Study', col:'#38bdf8', icon:'üìö'}
        ];

        function setEraser(btn) { 
            isEraser = true; 
            document.querySelectorAll('.subject-btn').forEach(b => b.classList.remove('active')); 
            btn.classList.add('active'); 
        }

        function renderSubs() {
            const list = document.getElementById('subList');
            const addBtn = list.querySelector('button[onclick="openAddSubject()"]');
            const eraser = document.getElementById('eraserBtn');
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏° (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏¢‡∏≤‡∏á‡∏•‡∏ö‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°)
            Array.from(list.children).forEach(c => { if(c !== addBtn && c !== eraser) c.remove(); });
            
            subjects.forEach((s, index) => {
                const btn = document.createElement('button');
                btn.className = "subject-btn min-w-[75px] p-2 rounded-xl text-center bg-slate-50";
                btn.style.color = s.col;
                
                // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤
                const del = document.createElement('div');
                del.className = "delete-sub";
                del.innerHTML = "‚úï";
                del.onclick = (e) => { e.stopPropagation(); deleteSub(index); };
                btn.appendChild(del);

                const act = () => { 
                    isEraser = false; curCol = s.col; 
                    document.querySelectorAll('.subject-btn').forEach(b => b.classList.remove('active')); 
                    btn.classList.add('active'); 
                };
                btn.onclick = act; btn.ontouchstart = act;
                btn.innerHTML += `<div class="text-lg">${s.icon}</div><div class="text-[8px] font-900 uppercase">${s.name}</div>`;
                list.insertBefore(btn, addBtn);
            });
            localStorage.setItem('mySubs', JSON.stringify(subjects));
        }

        function openAddSubject() {
            const name = prompt("‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤ (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£):");
            if (!name) return;
            const icon = prompt("‡πÉ‡∏™‡πà‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô üìö, ‚öΩ, üìù):", "‚≠ê");
            const color = prompt("‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏™‡∏µ (‡πÄ‡∏ä‡πà‡∏ô #FF5733) ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ñ‡∏±‡∏î‡πÑ‡∏õ:", "#6366f1");
            
            subjects.push({ name: name.slice(0, 8), col: color, icon: icon || '‚≠ê' });
            renderSubs();
        }

        function deleteSub(index) {
            if(confirm("‡∏•‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) {
                subjects.splice(index, 1);
                renderSubs();
            }
        }

        function buildGrid() {
            const g = document.getElementById('mainGrid');
            for(let h=4; h<=23; h++) {
                const row = document.createElement('div'); row.className = "time-row flex items-center gap-2";
                row.innerHTML = `<span class="text-[9px] font-900 text-slate-300 w-8 text-right">${h}:00</span>`;
                const slots = document.createElement('div'); slots.className = "flex-1 grid grid-cols-6 gap-1";
                for(let i=0; i<6; i++) {
                    const s = document.createElement('div'); s.className = "slot";
                    const paint = (el) => {
                        if(isEraser) { el.style.backgroundColor = ''; el.removeAttribute('data-c'); }
                        else { el.style.backgroundColor = curCol; el.setAttribute('data-c', curCol); }
                    };
                    s.onmousedown = () => { isDragging = true; paint(s); };
                    s.onmouseover = () => { if(isDragging) paint(s); };
                    slots.appendChild(s);
                }
                row.appendChild(slots); g.appendChild(row);
            }
        }

        // ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏ô‡∏¥‡πâ‡∏ß iPad/Phone
        window.addEventListener('touchstart', (e) => { if(e.target.classList.contains('slot')) isDragging = true; });
        window.addEventListener('touchmove', (e) => {
            if(!isDragging) return;
            e.preventDefault();
            const t = e.touches[0];
            const target = document.elementFromPoint(t.clientX, t.clientY);
            if(target && target.classList.contains('slot')) {
                if(isEraser) { target.style.backgroundColor = ''; target.removeAttribute('data-c'); }
                else { target.style.backgroundColor = curCol; target.setAttribute('data-c', curCol); }
            }
        }, {passive: false});
        window.addEventListener('touchend', () => isDragging = false);

        async function takeSnap() {
            const filtered = document.getElementById('filteredGrid'); filtered.innerHTML = '';
            let totalMins = 0;
            document.querySelectorAll('.time-row').forEach(r => {
                const slots = r.querySelectorAll('.slot');
                let hasColor = false;
                slots.forEach(s => { if(s.hasAttribute('data-c')) hasColor = true; });
                if(hasColor) {
                    const snapRow = document.createElement('div'); snapRow.className = "flex items-center gap-2 mb-1";
                    const label = document.createElement('span'); label.className = "text-[9px] font-900 text-slate-400 w-8 text-right";
                    label.innerText = r.querySelector('span').innerText;
                    const grid = document.createElement('div'); grid.className = "flex-1 grid grid-cols-6 gap-1";
                    slots.forEach(s => {
                        const sSnap = document.createElement('div'); sSnap.className = "h-5 rounded-[2px] border border-slate-50";
                        if(s.hasAttribute('data-c')) { sSnap.style.backgroundColor = s.getAttribute('data-c'); totalMins += 10; }
                        else { sSnap.style.backgroundColor = '#f8fafc'; }
                        grid.appendChild(sSnap);
                    });
                    snapRow.appendChild(label); snapRow.appendChild(grid);
                    filtered.appendChild(snapRow);
                }
            });
            if(totalMins === 0) return alert("‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏™‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
            document.getElementById('snapDate').innerText = document.getElementById('planDate').value;
            const h = Math.floor(totalMins / 60); const m = totalMins % 60;
            document.getElementById('snapTotal').innerText = `${h}h ${m.toString().padStart(2, '0')}m`;
            const area = document.getElementById('photoTemplate'); area.style.display = 'block';
            const canvas = await html2canvas(document.getElementById('captureArea'), {scale:2});
            const link = document.createElement('a'); link.download = 'Focus_FADLEEROMDON.png'; link.href = canvas.toDataURL(); link.click();
            area.style.display = 'none';
        }

        window.onload = () => { document.getElementById('planDate').valueAsDate = new Date(); renderSubs(); buildGrid(); };
    </script>
</body>
</html>
